###warm ant population genetic analyses
library('RADami')
library('phytools')
library('gdata')
library('seqinr')
library('ape')
library('adegenet')
source('./waFunctions.R')

###http://adegenet.r-forge.r-project.org/files/tutorial-genomics.pdf


###Only analyze identified specimens
### rad1 <- read.dna('../data/UVM_ant_ids.fasta',format='fasta') ###only samples with species ids
### rad1 <- read.dna('../data/UVM_ant_ids.fasta',format='fasta') ###only samples with species ids
rad1 <- read.dna('../data/UVM_ant_sequences.fasta',format='fasta') ###all sequences
info <- info <- read.xls('../data/RADseq_mastersheet_2014.xlsx')

### quality control
rad1 <- waQC(rad1,0.5)

### formalize labels
site.labs <- toupper(paste(as.character(info$Site),info$Collection_no,sep=''));site.labs <- sub('BRM /BRF','BRF',site.labs);site.labs <- sub('IJAMSQL','IJAMS2',site.labs);site.labs <- sub(" \\(SECOND SAMPLE\\)","42",site.labs)
rad.labs <- waSampleIDs(x=attributes(rad1)$names)
rad.labs[rad.labs%in%phyt.labs] <- site.labs[match(rad.labs,phyt.labs,nomatch=0)]
info.rad <- info[match(rad.labs,site.labs),]
rad.labs <- paste(rad.labs,info.rad[,4],info.rad[,5])

### distance based analyses
rad1.d <- dist.dna(rad1,model='F84')
rad1.m <- as.matrix(rad1.d)
attr(rad1.d,'Labels') <- rad1.labs <- rad.labs
rownames(rad1.m) <- colnames(rad1.m) <- rad1.labs
###rad1.tree <- hclust(rad1.d,method='average')
rad1.tree <- upgma(rad1.d)

### plots
heatmap(rad1.m)
plot(rad1.tree)
head(sort(max.dist,decreasing=TRUE))

###Linking to traits
dem <- read.xls('/Users/Aeolus/Dropbox/WarmAntDimensions/Phytotron\ 2013/Phytotron\ colonies\ 2013\ Traits.xlsx',sheet=1) ###demography
dem <- dem[1:46,]
### dev <- read.xls('/Users/Aeolus/Dropbox/WarmAntDimensions/Phytotron\ 2013/Phytotron\ colonies\ 2013\ Traits.xlsx',sheet=2) ###developmental traits
### mor <- read.xls('/Users/Aeolus/Dropbox/WarmAntDimensions/Phytotron\ 2013/Phytotron\ colonies\ 2013\ Traits.xlsx',sheet=3) ###mortality
dem[,5] <- dem[,5] * -1
plot(dem[,5:4],pch='',xlim=range(dem[,5])+c(-5,5))
text(dem[,5:4],labels=dem$Colony.ID,cex=0.75)
