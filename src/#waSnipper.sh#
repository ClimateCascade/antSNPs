#! /bin/bash

###To demultiplex and filter sequencer lane:


gunzip ddRAD1.fq.gz

# use sabre.sh to demultiplex.  Note - need to make barcode file in correct format:
# FOR ALL SCRIPTS, YOU NEED TO edit script to point to the right directory, file, etc.

# Trim off barcodes with fastx.sh
# Filter out reads with bad data with fastq.sh
# The filtered reads are the ones you will use for downstream applications.

# Getting SNPs with STACKS:
# ustacks.sh
# cstacks.sh
# sstacks.sh

 
# after both of these, run genotypes.sh to get the batch haplotypes file.
# CRITICAL: you need to edit this file (I use nano) to eliminate the space between "Catalog" and "ID" on the first line - this is a stupid thing that Stacks does that messes up all the column operations in bash.  

# Use haplotypes_to_sequence.sh to convert this into a fasta file
cd /N/dc2/scratch/scahan/ddRAD1_fastq/ddRAD1_fastq/filtered/output
INPUT=batch_2.haplotypes_3.tsv
VAR=batch_2.haplotypes_variable.tsv
AMBIG=batch_2.haplotypes_single.tsv
grep -v	"consensus" $INPUT > $VAR                
python haplotypes_to_ambig_code.py $VAR  
python SNP_to_sequence_UVM.py $AMBIG

# Note that the fact that monomorphic loci are removed means the number and identities of the loci used will be different with each set of samples.  Right now it does not filter by number of SNPs in the tag - Andrew has a script to do this but I did not use it here.

